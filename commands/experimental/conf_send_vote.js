const { SlashCommandBuilder, PermissionFlagsBits, PermissionsBitField, ChannelType } = require('discord.js')

module.exports = {
    data: new SlashCommandBuilder()
        .setName("c_send_vote")
        .setDescription("âŒ ðŸ¤–âŒ¡ Envie o embed de votaÃ§Ã£o em algum servidor!")
        .addStringOption(option =>
            option.setName("canal")
                .setDescription("O canal que serÃ¡ enviado")
                .setRequired(true))
        .setDefaultMemberPermissions(PermissionFlagsBits.ManageGuild | PermissionFlagsBits.Administrator),
    async execute({ client, user, interaction }) {

        if (!client.x.owners.includes(interaction.user.id)) return

        const id_canal = interaction.options.getString("canal")
        const canal = client.discord.channels.cache.get(id_canal)

        const embed = client.create_embed({
            title: `${client.tls.phrase(user, "inic.vote.titulo")} ${client.emoji("emojis_dancantes")}`,
            color: "turquesa",
            description: `${client.tls.phrase(user, "inic.vote.descricao", [client.emoji("emojis_dancantes"), client.emoji("emojis_dancantes")])} <t:1692460800:f>!\n\n:flag_de: :flag_nl: :flag_se: :flag_tr: :flag_jp: :flag_de: :flag_nl: :flag_se: :flag_tr: :flag_jp:\n:flag_nl: :flag_se: :flag_tr: :flag_jp: :flag_de: :flag_nl: :flag_se: :flag_tr: :flag_jp: :flag_de:\n:flag_se: :flag_tr: :flag_jp: :flag_de: :flag_nl: :flag_se: :flag_tr: :flag_jp: :flag_de: :flag_nl:`,
            footer: {
                text: { tls: "inic.vote.rodape" }
            }
        }, user)

        const row = client.create_buttons([
            { id: "vote_button", name: 'Deutsch', emoji: "ðŸ‡©ðŸ‡ª", type: 0, data: "de" },
            { id: "vote_button", name: 'Nederlands', emoji: "ðŸ‡³ðŸ‡±", type: 0, data: "nl" },
            { id: "vote_button", name: 'Svenska', emoji: "ðŸ‡¸ðŸ‡ª", type: 0, data: "se" },
            { id: "vote_button", name: 'TÃ¼rkÃ§e', emoji: "ðŸ‡¹ðŸ‡·", type: 0, data: "tr" },
            { id: "vote_button", name: 'æ—¥æœ¬èªž', emoji: "ðŸ‡¯ðŸ‡µ", type: 0, data: "jp" }
        ], interaction)

        if (canal) {
            // Enviando os anÃºncios para os canais
            if (canal.type === ChannelType.GuildText || canal.type === ChannelType.GuildAnnouncement) {

                // PermissÃ£o para enviar mensagens no canal
                if (await client.execute("permissions", { id_user: client.id(), permissions: [PermissionsBitField.Flags.SendMessages, PermissionsBitField.Flags.ViewChannel], canal })) {
                    interaction.reply({
                        content: `:mailbox: | O embed de votaÃ§Ã£o foi enviado ao canal <#${id_canal}> com sucesso!`,
                        flags: "Ephemeral"
                    })

                    client.execute("notify", { id_canal: id_canal, conteudo: { embeds: [embed], components: [row] } })
                } else
                    interaction.reply({
                        content: `${client.defaultEmoji("guard")} | Eu nÃ£o posso enviar mensagens nesse canal ( <#${id_canal}> ) por falta de permissÃµes.`,
                        flags: "Ephemeral"
                    })
            } else
                interaction.reply({
                    content: ":o: | O tipo do canal definido nÃ£o Ã© de texto, por favor tente novamente",
                    flags: "Ephemeral"
                })
        } else
            interaction.reply({
                content: ":mag: | O canal mencionado nÃ£o existe.",
                flags: "Ephemeral"
            })
    }
}